Стандартные средства конфигурирования (Modbus)
==============================================
  Для ПЛК BRIC имеется возможность опроса данных по протоколу Modbus, ретрансляции и расширения адресного пространства. Для этого необходимо заложить в структуру проекта элемент «Поддержка Modbus» и элемент для выполнения необходимого функционала:

  * ModbusRTUMaster (фоновый опрос устройств для чтения и записи данных по протоколу Modbus);
  
  * ModbusRoute (ретрансляция пакетов из одного канала в другой);
  
  * MemoryArea (расширение адресного пространства).

  По умолчанию, Modbus адресное пространство имеет зарезервированную область адресов:

  0х30000–0х39999 – Область адресов, выделенных под чтение и запись массивов пользовательской программы;

  0х40000–0х49999 – Oбласть адресов, выделенных под чтение и запись регистров пользовательской программы;

  0х50000–0х59999 – Oбласть адресов, выделенных под архивные данные;
  
  0х60000–0х69999 – Область адресов, выделенных под системные регистры ПЛК.

  Настройка интерфейсов и протоколов обмена в ИСР Beremiz имеет следующую последовательность действий:

  .. figure:: images/beremiz/modbus.png
        :width: 600
        :align: center

Создание подмодуля ModbusRTUMaster
----------------------------------
  Обмен данными со сторонними устройствами по Modbus осуществляет элемент «ModbusRTUMaster». Для подключения необходимо добавить его в элемент «Поддержка Modbus», щелкнув правой клавишей мыши и выбрав пункт «Добавить ModbusRTUMaster». Затем в окне конфигурации настроить канал опроса. Для каждого физического канала может быть не более одного элемента «ModbusRTUMaster».
    
  .. figure:: images/beremiz/13.png
        :align: center
        
        *Добавление в структуру проекта ModbusRTUMaster*

  .. figure:: images/beremiz/14.png
        :width: 600
        :align: center
            
        *Выбор параметров ModbusRTUMaster*

  Установка параметров ModbusRTUMaster включает следующие позиции:
    
  * Последовательный порт (выбрать порт из перечня: RS_232_UART, RS_485_1_UART, RS_485_2_UART)
    
  * Скорость передачи данных (выбор производится из установленного ряда: 1200, 2400, 4800, 9600,14400, 19200, 28800, 38400, 56000 57600, 76800, 115200 бит/с.)
    
  * Количество информационных битов
    
  * Тип чётности байта при её наличии (выбор производится из установленного ряда: even(чётный), none(без чётности), odd(нёчетный))
    
  * Количество Стоп–битов
    
  * Период опроса.

  Далее необходимо добавить элементы «ModbusRequest» и настроить их. Разрешается добавлять несколько элементов с разными параметрами, тогда они будут встроены в порядок опроса последовательно.

  .. figure:: images/beremiz/15.png
        :align: center

        *Добавление в структуру проекта ModbusRequest*

  .. figure:: images/beremiz/16.png
        :width: 600
        :align: center

        *Выбор параметров ModbusRequest*
        
  Установка параметров ModbusRequest включает следующие позиции:
    
  * Выбор команды (описание команд указано в Приложении Г)

    .. figure:: images/beremiz/17.png
        :align: center

  * Адрес slave–устройства с которым производится обмен данными по Modbus протоколу
    
  * Число Reg/Coil в одном пакете (для Reg до 120)
    
  * Адрес первого Reg/Coil в пакете согласно адресного пространства slave–устройства
    
  * Таймаут в мс. (не должен превышать период опроса).

  После установления необходимых параметров «ModbusRequest» необходимо обозначить глобальные переменные, которые используются при передаче данных по протоколу Modbus. Для этого в панели переменных и констант необходимо для переменной в ячейке «Location» записать ссылку на адрес. Подробное описание конфигурирования см. в разделе Привязка глобальным переменным Modbus адреса.

Создание ModbusRoute
--------------------
  ПЛК BRIC имеет возможность ретранслировать пакеты из одного канала в другой. Также есть возможность приёма-передачи пакетов Modbus TCP в Modbus RTU и Modbus RTU – Modbus RTU. Для подключения подмодуля «ModbusRoute» необходимо подвести курсор к созданной ветке «Поддержка Modbus», щелкнуть правой клавишей мыши и выбрать пункт «Добавить ModbusRoute».   
  
  .. figure:: images/beremiz/18.png
        :align: center

        *Добавление в структуру проекта ModbusRoute*

  Окно конфигурирования ModbusRoute представлено на рисунке ниже:

  .. figure:: images/beremiz/19.png
        :width: 600
        :align: center

        *Выбор параметров ModbusRoute*
    
  Установка параметров ModbusRoute включает следующие позиции:
    
  * Задействованные каналы (выбрать порт из перечня: PACKET_CHANNEL_TCP, RS_232_UART, RS_485_1_UART, RS_485_2_UART, PACKET_CHANNEL_UDP) [1]_ ;

    .. figure:: images/beremiz/20.png
        :align: center

  * ModbusAddress (Modbus адрес устройства, для которого производится ретрансляция из одного канала в другой) [2]_ .

  .. [1] PACKET_CHANNEL_TCP, PACKET_CHANNEL_UDP данные передаваемые протоколами (TCP, UDP) через канал связи Ethernet.
  .. [2] При указании адреса 255 ретранслирует все пакеты полученные с канала «извлечения» в канал «записи».

Создание MemoryArea
-------------------
  ПЛК BRIC имеет возможность увеличить адресное пространство для каждого типа регистров (Coils, Input Discrete, Input Registers, Holding Registers) при помощи подключения подмодуля «MemoryArea». Для подключения «MemoryArea» необходимо подвести курсор к созданной ветке «Поддержка Modbus», щелкнуть правой клавишей мыши и выбрать пункт «Добавить MemoryArea».   
  
  .. figure:: images/beremiz/21.png
        :align: center

        *Добавление в структуру проекта MemoryArea*

  Окно конфигурирования MemoryArea показано на рисунке ниже:

  .. figure:: images/beremiz/22.png
        :width: 600
        :align: center

        *Выбор параметров MemoryArea*

  Установка параметров MemoryArea включает следующие позиции:

  * Выбор типа регистра адресного пространства (Coils, Input Discrete, Input Registers, Holding Registers)

    .. figure:: images/beremiz/23.png
        :align: center

  * Regs_number количество регистров в адресном пространстве [3]_

  * Start_Address первый Modbus-адрес адресного пространства.

  Расположение разных типов регистров независимо, поэтому номера регистров разных типов могут иметь одинаковое значение. Ограничением по количеству регистров является:

  * Размер итогового файла сборки проекта, указываемого в отладочной панели под элементом «dec» строки (text data bss dec hex filename), составляющий не более «197524»

  * Количество регистров в адресном пространстве (65530).

  .. [3] Modbus-адреса, задаваемые в разных адресных пространствах для одинаковых типов регистров, не должны повторяться
